<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Use the Quantum Accelerator to improve your DFT calculations | Tom Demeyere</title> <meta name="author" content="Tom Demeyere"> <meta name="description" content="I recently discovered Quacc and I implemented an interface for the Quantum Espresso code. Let's try it!"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://tomdemeyere.github.io/blog/2024/quacc-espresso/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Tom </span>Demeyere</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Use the Quantum Accelerator to improve your DFT calculations</h1> <p class="post-meta">February 4, 2024</p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/quacc"> <i class="fa-solid fa-hashtag fa-sm"></i> Quacc</a>   <a href="/blog/tag/dft"> <i class="fa-solid fa-hashtag fa-sm"></i> DFT</a>   <a href="/blog/tag/espresso"> <i class="fa-solid fa-hashtag fa-sm"></i> Espresso</a>   <a href="/blog/tag/ase"> <i class="fa-solid fa-hashtag fa-sm"></i> ASE</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>Not long ago, I was looking at the <a href="https://wiki.fysik.dtu.dk/ase/" rel="external nofollow noopener" target="_blank">Atomic Simulation Environment</a> (ASE) <a href="https://wiki.fysik.dtu.dk/ase/ecosystem.html" rel="external nofollow noopener" target="_blank">ecosystem page</a>, when I noticed a new contender: The Quantum Accelerator (Quacc) from the <a href="https://rosen.cbe.princeton.edu" rel="external nofollow noopener" target="_blank">Rosen group</a> at Princeton. It is a new Python package that aims to connect computational chemistry codes to various workflow engines. I quickly got hooked and tried to use it for my work. The package runs around the Atomic Simulation Environment (ASE) and provides recipes and presets to run calculations with ease. You don’t necessarily have to use a workflow engine to use it, this tutorial will not use any. <a href="https://quantum-accelerators.github.io/quacc/install/install.html#installing-quacc" rel="external nofollow noopener" target="_blank">The installation</a> is pretty standard, the only important thing is that you will need the latest ASE version from git before installing it.</p> <p>Unfortunately, at the time there was no implementation for Quantum Espresso, I did my own and merged it to the main repository. If you know how to use the ASE Espresso interface, Quacc will not be difficult to get your head around.</p> <h3 id="espresso-tutorial">Espresso tutorial</h3> <p>Before running everything, Quacc has a configuration file that you must setup correctly to run Espresso calculations. Two important things to set are the path to the Espresso binary and the pseudopotential directory. This configuration file is by default located at <code class="language-plaintext highlighter-rouge">~/.quacc.yaml</code>. Let’s use the CLI to set it up:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Setting ESPRESSO_BIN_DIR is not needed if pw.x is in your PATH</span>
quacc <span class="nb">set </span>ESPRESSO_BIN_DIR /path/to/espresso/bin
quacc <span class="nb">set </span>ESPRESSO_PSEUDO /path/to/espresso/pseudopotentials
</code></pre></div></div> <p>If you open the configuration file you should notice the changes. For the purpose of this tutorial, you will need to set the <code class="language-plaintext highlighter-rouge">ESPRESSO_PSEUDO</code> setting to a folder that contains the full <a href="https://www.materialscloud.org/discover/sssp/table/efficiency" rel="external nofollow noopener" target="_blank">SSSP 1.3.0 efficiency</a> pseudopotential library.</p> <p>Now, let’s try to run a simple calculation. Quacc contains recipes and everything is done under the hood, no need for you to write input files. Let’s try to run a simple calculation for a bulk system.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">ase.build</span> <span class="kn">import</span> <span class="n">bulk</span>
<span class="kn">from</span> <span class="n">quacc.recipes.espresso.core</span> <span class="kn">import</span> <span class="n">static_job</span>

<span class="n">atoms</span> <span class="o">=</span> <span class="nf">bulk</span><span class="p">(</span><span class="sh">"</span><span class="s">Si</span><span class="sh">"</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="nf">static_job</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
</code></pre></div></div> <p><strong>That’s it! You just ran a DFT calculation!</strong></p> <hr> <h5 id="where-are-the-results"><strong>Where are the results?</strong></h5> <p>Results are stored in the variable <code class="language-plaintext highlighter-rouge">results</code> which is a dictionary.</p> <ul> <li> <code class="language-plaintext highlighter-rouge">results["atoms"]</code> contains the final ASE Atoms object.</li> <li> <code class="language-plaintext highlighter-rouge">results["results"]</code> contains results from the ASE calculator, such as the energy, forces…</li> <li> <code class="language-plaintext highlighter-rouge">results["input_atoms"]</code> contains information about atoms sent to the job.</li> <li> <code class="language-plaintext highlighter-rouge">results["dir_name"]</code> contains the directory where the calculation was ran.</li> </ul> <p>There are other keys in the dictionary, but these are the most important ones. Printing the dictionary will give you a better idea of what’s inside.</p> <p>For files, you will notice Quacc creating folders in the current working directory. Calculations are run in temporary folders and at the end files are moved and gzipped to a permanent folder. If this behaviour seems strange, it makes more sense when you consider the use of workflow engines. Settings are available to change the default behaviour; if you want more information about directory management, the Quacc documentation has a nice <a href="https://quantum-accelerators.github.io/quacc/user/settings/file_management.html" rel="external nofollow noopener" target="_blank">page</a> about it.</p> <hr> <h5 id="how-do-i-change-the-espresso-keywords"><strong>How do I change the Espresso keywords?</strong></h5> <p>The static_job is pretty much a wrapper around the ASE Espresso calculator for this purpose. You can pass any parameter that you would pass to the Espresso calculator. Here are some examples:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># input_data in flat dictionary format
</span><span class="nf">static_job</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">input_data</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">ecutwfc</span><span class="sh">"</span><span class="p">:</span> <span class="mi">40</span><span class="p">},</span> <span class="n">kpts</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="c1"># input_data in nested dictionary format, kspacing in units of 1/Å
</span><span class="nf">static_job</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">input_data</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">system</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">ecutwfc</span><span class="sh">"</span><span class="p">:</span> <span class="mi">40</span><span class="p">}},</span> <span class="n">kspacing</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span>
</code></pre></div></div> <hr> <h5 id="what-are-the-static_job-parameters"><strong>What are the static_job parameters?</strong></h5> <p>Let’s look at the static_job signature:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@job</span>
<span class="k">def</span> <span class="nf">static_job</span><span class="p">(</span>
    <span class="n">atoms</span><span class="p">:</span> <span class="n">Atoms</span><span class="p">,</span>
    <span class="n">preset</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="bp">None</span> <span class="o">=</span> <span class="sh">"</span><span class="s">sssp_1.3.0_pbe_efficiency</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">parallel_info</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="bp">None</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
    <span class="n">test_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="n">copy_files</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span> <span class="o">|</span> <span class="bp">None</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">calc_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RunSchema</span><span class="p">:</span>
</code></pre></div></div> <p>The preset parameter is the one that defines the pseudopotentials here, it is doing so by looking at a yaml file located in the <code class="language-plaintext highlighter-rouge">ESPRESSO_PRESET</code> directory. By default, this directory is located inside the Quacc package and no further setup is required. The custom Espresso calculator will look at the recommended cutoff for the elements in the calculation and take the highest one automatically. Preset files for Espresso can be browsed on the <a href="https://github.com/Quantum-Accelerators/quacc/tree/main/src/quacc/calculators/espresso/presets" rel="external nofollow noopener" target="_blank">Quacc github</a>. You will notice the existence of other presets such as “esm_metal_slab_efficiency.yaml” or “tough_metal_clusters_efficiency.yaml” which additionally change the <code class="language-plaintext highlighter-rouge">input_data</code>. <strong>Of course, any parameters manually passed that conflict with the preset will override it</strong>. If presets are not of interest to you, just set it to <code class="language-plaintext highlighter-rouge">None</code>.</p> <p>Let’s look at the other parameters, the <code class="language-plaintext highlighter-rouge">parallel_info</code> parameter is used to define the parallelization settings, ASE style. The <code class="language-plaintext highlighter-rouge">test_run</code> parameter is used to run a test calculation, it will create a “pwscf.EXIT” file which instructs pw.x to perform a dry-run, useful for checking that your input does not contain any errors. The <code class="language-plaintext highlighter-rouge">copy_files</code> parameter is used to copy files from specified directories to the calculation directory, useful for restarting for example.</p> <hr> <h5 id="how-do-i-run-anything-else"><strong>How do I run anything else?</strong></h5> <p>I implemented various recipes in Quacc for Espresso, you can find them in the <a href="https://quantum-accelerators.github.io/quacc/user/recipes/recipes_list.html#quantum-espresso" rel="external nofollow noopener" target="_blank">documentation</a>. Since I recently extended the ASE Espresso interface to other binaries, it is now possible to use other binaries such as ph.x, pp.x, dos.x, etc…</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">quacc.recipes.espresso.core</span> <span class="kn">import</span> <span class="n">ase_relax_job</span>
<span class="kn">from</span> <span class="n">quacc.recipes.espresso.phonons</span> <span class="kn">import</span> <span class="n">phonon_job</span>

<span class="n">relax_results</span> <span class="o">=</span> <span class="nf">ase_relax_job</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
<span class="n">phonon_results</span> <span class="o">=</span> <span class="nf">phonon_job</span><span class="p">(</span><span class="n">relax_results</span><span class="p">[</span><span class="sh">"</span><span class="s">dir_name</span><span class="sh">"</span><span class="p">])</span>
</code></pre></div></div> <p>The above code will run a relaxation calculation using ASE optimizers and then run a phonon calculation using ph.x. Similarly, you can change the parameters of the phonon calculations by passing <code class="language-plaintext highlighter-rouge">input_data</code> and other parameters to the phonon_job function, everything should be described in the documentation. The Espresso calculator in Quacc takes care of activating restart keywords such as <code class="language-plaintext highlighter-rouge">startingpot</code> and <code class="language-plaintext highlighter-rouge">startingwfc</code> during the optimization phase to avoid starting from scratch at each step. Of course, if you want to use the Espresso internal optimizer, you can use the <code class="language-plaintext python highlighter-rouge">quacc.recipes.espresso.core.relax_job</code> function.</p> <hr> <p>That’s it for this post! This is probably the first part of a series of posts about Quacc. Here is what to expect from the next blog posts:</p> <ol> <li> <p>Why do we need workflow engines; how to create your own workflows; how to run them on HPC.</p> </li> <li> <p>How to use a monkey-patched version of ASE’s NEB class to run calculations concurrently on HPC without the need for explicit parallel code.</p> </li> <li> <p>How to modify an ASE dynamics object to perform additional actions, such as projwfc.x or pp.x jobs at a predefined interval in an optimization or MD run.</p> </li> </ol> <p>In the meantime, if you are interested you can learn more by having a look at the <a href="https://quantum-accelerators.github.io/quacc/" rel="external nofollow noopener" target="_blank">Quacc documentation</a>. Or wait until I write a post about it in the coming days!</p> <script src="https://giscus.app/client.js" data-repo="tomdemeyere/tomdemeyere.github.io" data-repo-id="R_kgDOK8-7Kg" data-category="Comments" data-category-id="DIC_kwDOK8-7Ks4Cc9vt" data-mapping="title" data-strict="1" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="preferred_color_scheme" data-lang="en" crossorigin="anonymous" async=""> </script> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/workflows-manager-for-dft/">Use Parsl to create concurrent computational chemistry workflows</a> </li> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Tom Demeyere. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Last updated: March 26, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?07b8786bab9b4abe90d10e61f7d12ff7" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>